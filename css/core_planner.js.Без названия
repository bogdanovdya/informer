(function(){if(!!window.BX.CPlanner)return;var n=window.BX,t="/bitrix/tools/intranet_planner.php";n.planner_query=function(e,i,a,o,r){if(n.type.isFunction(a)){o=a;a={}}var s={method:"POST",dataType:"json",url:(e||t)+"?action="+i+"&site_id="+n.message("SITE_ID")+"&sessid="+n.bitrix_sessid(),data:n.ajax.prepareData(a),onsuccess:function(t){if(!!o){o(t,i)}n.onCustomEvent("onPlannerQueryResult",[t,i])},onfailure:function(t,e){if(e&&e.type=="json_failure"){new n.PopupWindow("planner_failure_"+Math.random(),null,{content:n.create("DIV",{style:{width:"300px"},html:n.message("JS_CORE_PL_ERROR")+"<br /><br /><small>"+n.util.strip_tags(e.data)+"</small>"}),buttons:[new n.PopupWindowButton({text:n.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-decline",events:{click:function(){this.popupWindow.close()}}})]}).show()}}};return n.ajax(s)};n.CPlanner=function(t){this.DATA=t;this.DIV=null;this.DIV_ADDITIONAL=null;this.WND=null;n.addCustomEvent("onGlobalPlannerDataRecieved",n.delegate(this.onPlannerBroadcastRecieved,this));n.onCustomEvent("onPlannerInit",[this,this.DATA])};n.CPlanner.prototype.onPlannerBroadcastRecieved=function(t){this.DATA=t;n.onCustomEvent(this,"onPlannerDataRecieved",[this,this.DATA])};n.CPlanner.prototype.draw=function(){if(!this.DIV){this.DIV=n.create("DIV",{props:{className:"bx-planner-content"}})}n.onGlobalCustomEvent("onGlobalPlannerDataRecieved",[this.DATA]);return this.DIV};n.CPlanner.prototype.drawAdditional=function(){if(!this.DIV_ADDITIONAL){this.DIV_ADDITIONAL=n.create("DIV",{style:{minHeight:0}})}return this.DIV_ADDITIONAL};n.CPlanner.prototype.addBlock=function(t,e){if(!t||!n.type.isElementNode(t)){return}t.bxsort=parseInt(e)||100;if(!!t.parentNode){t.parentNode.removeChild(t)}var i=this.DIV.firstChild;while(i){if(i==t)break;if(!!i.bxsort&&i.bxsort>t.bxsort){this.DIV.insertBefore(t,i);break}i=i.nextSibling}if(!t.parentNode||!n.type.isElementNode(t.parentNode)){this.DIV.appendChild(t)}};n.CPlanner.prototype.addAdditional=function(n){this.drawAdditional().appendChild(n)};n.CPlanner.prototype.update=function(n){if(!!n){this.DATA=n;this.draw()}else{this.query("update")}};n.CPlanner.prototype.query=function(e,i){return n.planner_query(t,e,i,n.proxy(this.update,this))};n.CPlanner.query=function(e,i){return n.planner_query(t,e,i)}})();